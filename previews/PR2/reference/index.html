<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Reference · MagneticResonanceSignals.jl</title><link href="https://fonts.googleapis.com/css?family=Lato|Roboto+Mono" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.11.1/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit">MagneticResonanceSignals.jl</span></div><form class="docs-search" action="../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../">Overview</a></li><li><a class="tocitem" href="../guide/">How-to Guide</a></li><li class="is-active"><a class="tocitem" href>Reference</a><ul class="internal"><li><a class="tocitem" href="#MR-data-types-1"><span>MR data types</span></a></li><li><a class="tocitem" href="#Querying-MR-data-1"><span>Querying MR data</span></a></li><li><a class="tocitem" href="#High-level-file-IO-and-conversion-1"><span>High level file IO and conversion</span></a></li><li><a class="tocitem" href="#Low-level-file-IO-1"><span>Low level file IO</span></a></li><li><a class="tocitem" href="#High-level-signal-processing-1"><span>High level signal processing</span></a></li><li><a class="tocitem" href="#Low-level-signal-processing-1"><span>Low level signal processing</span></a></li><li><a class="tocitem" href="#Plotting-1"><span>Plotting</span></a></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>Reference</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Reference</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/TRIImaging/MagneticResonanceSignals.jl/blob/master/docs/src/reference.md#L" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="API-Reference-1"><a class="docs-heading-anchor" href="#API-Reference-1">API Reference</a><a class="docs-heading-anchor-permalink" href="#API-Reference-1" title="Permalink"></a></h1><h2 id="MR-data-types-1"><a class="docs-heading-anchor" href="#MR-data-types-1">MR data types</a><a class="docs-heading-anchor-permalink" href="#MR-data-types-1" title="Permalink"></a></h2><article class="docstring"><header><a class="docstring-binding" id="MagneticResonanceSignals.MRExperiment" href="#MagneticResonanceSignals.MRExperiment"><code>MagneticResonanceSignals.MRExperiment</code></a> — <span class="docstring-category">Type</span></header><section><div><pre><code class="language-julia">load_twix(twix_file_name)
load_twix(io)

MRExperiment(metadata, coils, quality_control, acq_data)</code></pre><p>Container for data from a generic magnetic resonance experiment: a series of <code>Acquisition</code>s, each of which records the coil response due to induced nuclear magnetization. This is currently specialized for the type of raw data produced by a Siemens scanner but could be generalized.</p><p>Note that the input pulse sequence is not recorded in Siemens raw format, so it&#39;s not available here. The only way to know this in full detail is to simulate the sequence with the same input parameters using the Siemens <code>poet</code> tool from the Siemens proprietary IDEA development environment.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/TRIImaging/MagneticResonanceSignals.jl/blob/a57123595a88377871e2135ed156c643b922ab6c/src/io_twix.jl#LL146-L161">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="MagneticResonanceSignals.PRESS" href="#MagneticResonanceSignals.PRESS"><code>MagneticResonanceSignals.PRESS</code></a> — <span class="docstring-category">Type</span></header><section><div><p>A standard Point Resolved Spectroscopy (PRESS) experiment with <code>num_averages</code> acquisitions, possibly with navigator and reference scans included.</p><p>This is implemented as &quot;single voxel spectroscopy&quot; and is the standard product sequence for in vivo MR spectroscopy on Siemens scanners as of early 2020.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/TRIImaging/MagneticResonanceSignals.jl/blob/a57123595a88377871e2135ed156c643b922ab6c/src/PRESS.jl#LL19-L25">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="MagneticResonanceSignals.LCOSY" href="#MagneticResonanceSignals.LCOSY"><code>MagneticResonanceSignals.LCOSY</code></a> — <span class="docstring-category">Type</span></header><section><div><p>An L-COSY experiment with (<code>num_averages</code> × <code>nsamp_t1</code>) acquisitions, possibly with reference scans included.</p><p>The L-COSY pulse sequence is described in:</p><ul><li>Thomas, M. Albert, et al. &quot;Localized two‐dimensional shift correlated MR spectroscopy of human brain.&quot; Magnetic Resonance in Medicine 46.1 (2001): 58-67.</li><li>Thomas, M. Albert, et al. &quot;Evaluation of two‐dimensional L‐COSY and JPRESS using a 3 T MRI scanner: from phantoms to human brain in vivo.&quot; NMR in Biomedicine 16.5 (2003): 245-251.</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/TRIImaging/MagneticResonanceSignals.jl/blob/a57123595a88377871e2135ed156c643b922ab6c/src/LCOSY.jl#LL18-L29">source</a></section></article><h2 id="Querying-MR-data-1"><a class="docs-heading-anchor" href="#Querying-MR-data-1">Querying MR data</a><a class="docs-heading-anchor-permalink" href="#Querying-MR-data-1" title="Permalink"></a></h2><article class="docstring"><header><a class="docstring-binding" id="MagneticResonanceSignals.meta_search" href="#MagneticResonanceSignals.meta_search"><code>MagneticResonanceSignals.meta_search</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia">meta_search(metadata, pattern)</code></pre><p>Search through MR experiment <code>metadata</code> for a given regular expression, <code>pattern</code> or for a case insensitive string <code>pattern</code>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/TRIImaging/MagneticResonanceSignals.jl/blob/a57123595a88377871e2135ed156c643b922ab6c/src/io_twix.jl#LL682-L687">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="MagneticResonanceSignals.standard_metadata" href="#MagneticResonanceSignals.standard_metadata"><code>MagneticResonanceSignals.standard_metadata</code></a> — <span class="docstring-category">Function</span></header><section><div><p>Extract standard MR metadata about an experiment</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/TRIImaging/MagneticResonanceSignals.jl/blob/a57123595a88377871e2135ed156c643b922ab6c/src/core.jl#LL24-L26">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="MagneticResonanceSignals.scanner_time" href="#MagneticResonanceSignals.scanner_time"><code>MagneticResonanceSignals.scanner_time</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia">scanner_time(acq | expt)</code></pre><p>Get internal scanner time stamp from an acquisition or sequence of timestamps from an experiment.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/TRIImaging/MagneticResonanceSignals.jl/blob/a57123595a88377871e2135ed156c643b922ab6c/src/io_twix.jl#LL248-L253">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="MagneticResonanceSignals.sampledata" href="#MagneticResonanceSignals.sampledata"><code>MagneticResonanceSignals.sampledata</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia">sampledata(expt, index; downsample=1)</code></pre><p>Return the acquired data from <code>expt</code> at a given acqusition <code>index</code>.  If <code>downsample&gt;1</code>, the data will be subsampled by the given rate by truncating the tails of the signal in the Fourier spectral domain. This has the effect of removing noise by filtering away irrelevant high and low frequency components.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/TRIImaging/MagneticResonanceSignals.jl/blob/a57123595a88377871e2135ed156c643b922ab6c/src/core.jl#LL46-L53">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="MagneticResonanceSignals.count_cycles" href="#MagneticResonanceSignals.count_cycles"><code>MagneticResonanceSignals.count_cycles</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia">count_cycles(twix::MRExperiment)</code></pre><p>Get phase cycle length for Siemens twix.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/TRIImaging/MagneticResonanceSignals.jl/blob/a57123595a88377871e2135ed156c643b922ab6c/src/io_twix.jl#LL739-L743">source</a></section></article><h2 id="High-level-file-IO-and-conversion-1"><a class="docs-heading-anchor" href="#High-level-file-IO-and-conversion-1">High level file IO and conversion</a><a class="docs-heading-anchor-permalink" href="#High-level-file-IO-and-conversion-1" title="Permalink"></a></h2><article class="docstring"><header><a class="docstring-binding" id="MagneticResonanceSignals.mr_load" href="#MagneticResonanceSignals.mr_load"><code>MagneticResonanceSignals.mr_load</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia">mr_load(data)</code></pre><p>High level function for loading MR <code>data</code> and recognizing which experiment was run. The returned object describes the experimental conditions and acquisition schedule which can be used during data processing.  <code>data</code> may be a file name, <code>IO</code> stream, or a data structure describing raw acquisition data, for example, Siemens Twix.</p><p>If the experiment is not recognized, throw an exception.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/TRIImaging/MagneticResonanceSignals.jl/blob/a57123595a88377871e2135ed156c643b922ab6c/src/core.jl#LL30-L40">source</a></section><section><div><pre><code class="language-none">mr_load(twix::MRExperiment, repair=false)</code></pre><p>If <code>repair=true</code>, attempt to repair the experiment by discarding a subset of broken acquisitions where possible.</p><p>Recognizes spectro experiments in Siemens twix format, producing one of:</p><ul><li>PRESS (Siemens product sequence SVS_SE)</li><li>L-COSY (Customer sequences srcosy, svs_lcosy)</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/TRIImaging/MagneticResonanceSignals.jl/blob/a57123595a88377871e2135ed156c643b922ab6c/src/io_twix.jl#LL761-L770">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="MagneticResonanceSignals.twix_to_nmrpipe" href="#MagneticResonanceSignals.twix_to_nmrpipe"><code>MagneticResonanceSignals.twix_to_nmrpipe</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia">twix_to_nmrpipe(twix, nmrpipe_path)</code></pre><p><code>twix</code> is a path or open IO stream to the original twix data file. <code>nmrpipe</code> is a path or open IO stream to the result file to be written.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/TRIImaging/MagneticResonanceSignals.jl/blob/a57123595a88377871e2135ed156c643b922ab6c/src/io_nmrpipe.jl#LL327-L332">source</a></section></article><h2 id="Low-level-file-IO-1"><a class="docs-heading-anchor" href="#Low-level-file-IO-1">Low level file IO</a><a class="docs-heading-anchor-permalink" href="#Low-level-file-IO-1" title="Permalink"></a></h2><article class="docstring"><header><a class="docstring-binding" id="MagneticResonanceSignals.load_rda" href="#MagneticResonanceSignals.load_rda"><code>MagneticResonanceSignals.load_rda</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia">load_rda(rda_file)</code></pre><p>Load header dictionary and spectroscopy data from a Siemens .rda file.  Returns <code>header,data</code>, where <code>header</code> is a simple dictionary containing the ASCII header, and <code>data</code> is the time domain induced magnetization signal.</p><p>Single voxel spectroscopy data will be loaded as a vector containing the single magnentization signal.</p><p>For spectroscopy with a spatial component (that is, CSI data with at least one header field <code>CSIMatrixSize[i]</code> not equal to 1), an array of size N×I×K×J will be returned where I,J,K are the CSI indices 0,1,2 and the FID length is N.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/TRIImaging/MagneticResonanceSignals.jl/blob/a57123595a88377871e2135ed156c643b922ab6c/src/io_rda.jl#LL1-L14">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="MagneticResonanceSignals.save_rda" href="#MagneticResonanceSignals.save_rda"><code>MagneticResonanceSignals.save_rda</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia">save_rda(file, header, data)</code></pre><p>Save a single FID as Siemens format .rda.  <code>header</code> should be a dictionary of key values for the rda ASCII header.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/TRIImaging/MagneticResonanceSignals.jl/blob/a57123595a88377871e2135ed156c643b922ab6c/src/io_rda.jl#LL58-L63">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="MagneticResonanceSignals.load_twix" href="#MagneticResonanceSignals.load_twix"><code>MagneticResonanceSignals.load_twix</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia">load_twix(filename; header_only=false, acquisition_filter=(acq)-&gt;true,
          meas_selector=last)</code></pre><p>Load raw Siemens twix &quot;.dat&quot; format, producing an <code>MRExperiment</code> containing a sequence of acqisitions.</p><p>For large files, acquisitions may be filtered out during file loading by providing a predicate <code>acquisition_filter(acq)</code> which returns true when <code>acq</code> should be kept.  By default, all acquisitions are retained.</p><p>N4 VD-version twix may have data from more than one sequence (for example, the tune-up data may be included). Normally the data you&#39;re looking for is in the <code>meas_selector=last</code> chunk, but meas_selector is provided for the cases where you want to select other measurements.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/TRIImaging/MagneticResonanceSignals.jl/blob/a57123595a88377871e2135ed156c643b922ab6c/src/io_twix.jl#LL308-L323">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="MagneticResonanceSignals.save_felix" href="#MagneticResonanceSignals.save_felix"><code>MagneticResonanceSignals.save_felix</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia">save_felix(fname, data; bandwidth, frequency)</code></pre><p>Create Felix NMR file for 2D NMR experiment with 2D data matrix size <code>npoints = size(data)</code>, spectral width <code>bandwidth = (t2_bw, t1_bw)</code> and given spectrometer <code>frequency</code>, which should be unit-compatible with Hz.</p><p><code>data[i,:]</code> is assumed to contain the real time FIDs as acquired in the standard 2D COSY experiment (ie, the &quot;t2&quot; dimension).</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/TRIImaging/MagneticResonanceSignals.jl/blob/a57123595a88377871e2135ed156c643b922ab6c/src/io_felix.jl#LL189-L198">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="MagneticResonanceSignals.save_nmrpipe" href="#MagneticResonanceSignals.save_nmrpipe"><code>MagneticResonanceSignals.save_nmrpipe</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia">save_nmrpipe(io, signal, axes; frequency, ref_freq_offset)</code></pre><p>Convert twix into NMR Pipe format to be loaded into third party analytical software, such as MNova. This currently supports up to 2 dimension.</p><p>At minimal, for each dimension we should have:</p><ul><li>Signal data</li><li>Axes</li><li>Observation frequency (frequency)</li><li>Carrier frequency (<code>ref_freq_offset</code>)</li></ul><p><code>ref_freq_offset</code> is a tuple containing the relative frequency offset between obs_freq and frequency which will be set to 0 on the ppm scale.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/TRIImaging/MagneticResonanceSignals.jl/blob/a57123595a88377871e2135ed156c643b922ab6c/src/io_nmrpipe.jl#LL191-L205">source</a></section></article><h2 id="High-level-signal-processing-1"><a class="docs-heading-anchor" href="#High-level-signal-processing-1">High level signal processing</a><a class="docs-heading-anchor-permalink" href="#High-level-signal-processing-1" title="Permalink"></a></h2><article class="docstring"><header><a class="docstring-binding" id="MagneticResonanceSignals.extract_fids" href="#MagneticResonanceSignals.extract_fids"><code>MagneticResonanceSignals.extract_fids</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia">extract_fids(expt; downsample=1)</code></pre><p>Extract raw fid from experiment (PRESS/LCOSY) and apply channel combination</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/TRIImaging/MagneticResonanceSignals.jl/blob/a57123595a88377871e2135ed156c643b922ab6c/src/LCOSY.jl#LL47-L51">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="MagneticResonanceSignals.simple_averaging" href="#MagneticResonanceSignals.simple_averaging"><code>MagneticResonanceSignals.simple_averaging</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia">simple_averaging(spectro_expt)</code></pre><p>Simple channel combination and averaging for spectroscopic data acquisition.</p><p>Note that this uses a simple mean to combine acquisitions across the phase cycling dimension; it does no frequency alignment or other calibration.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/TRIImaging/MagneticResonanceSignals.jl/blob/a57123595a88377871e2135ed156c643b922ab6c/src/LCOSY.jl#LL85-L92">source</a></section><section><div><pre><code class="language-none">simple_averaging(fids)</code></pre><p>Do simple averaging from FIDs</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/TRIImaging/MagneticResonanceSignals.jl/blob/a57123595a88377871e2135ed156c643b922ab6c/src/processing.jl#LL24-L28">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="MagneticResonanceSignals.spectrum" href="#MagneticResonanceSignals.spectrum"><code>MagneticResonanceSignals.spectrum</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia">spectrum(lcosy::LCOSY,
         win1=t-&gt;sinebell(t, pow=2),
         win2=t-&gt;sinebell(t, skew=0.3, pow=2),
         t1pad=4,
         downsample=1)</code></pre><p>Compute spectrum from lcosy data with &quot;standard&quot; L-COSY processing parameters as have traditionally been used by Mountford et. al.</p><ul><li>Simple averaging</li><li>T2: skewed sine bell squared window, skew=0.3</li><li>T1: Sine bell squared window, 4x zero padded</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/TRIImaging/MagneticResonanceSignals.jl/blob/a57123595a88377871e2135ed156c643b922ab6c/src/LCOSY.jl#LL99-L111">source</a></section><section><div><pre><code class="language-none">spectrum(press::PRESS,
         win=t-&gt;sinebell(t, pow=2),,
         t1pad=4,
         downsample=1)</code></pre><p>Compute spectrum from press data with processing parameters as follows.</p><ul><li>Simple averaging</li><li>T: Sine bell squared window, 4x zero padded</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/TRIImaging/MagneticResonanceSignals.jl/blob/a57123595a88377871e2135ed156c643b922ab6c/src/PRESS.jl#LL86-L95">source</a></section><section><div><pre><code class="language-none">spectrum(signal::AxisArray)</code></pre><p>Compute the spectrum from time domain signal via Fourier Transform.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/TRIImaging/MagneticResonanceSignals.jl/blob/a57123595a88377871e2135ed156c643b922ab6c/src/processing.jl#LL34-L38">source</a></section></article><h2 id="Low-level-signal-processing-1"><a class="docs-heading-anchor" href="#Low-level-signal-processing-1">Low level signal processing</a><a class="docs-heading-anchor-permalink" href="#Low-level-signal-processing-1" title="Permalink"></a></h2><h3 id="Channel-combination-1"><a class="docs-heading-anchor" href="#Channel-combination-1">Channel combination</a><a class="docs-heading-anchor-permalink" href="#Channel-combination-1" title="Permalink"></a></h3><article class="docstring"><header><a class="docstring-binding" id="MagneticResonanceSignals.pca_channel_combiner" href="#MagneticResonanceSignals.pca_channel_combiner"><code>MagneticResonanceSignals.pca_channel_combiner</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia">pca_channel_combiner(signals; signal_range=nothing, channels=:)</code></pre><p>Compute channel combination object using PCA, assuming that each acquisition in <code>signals</code> has the same relative geometry of sample and coils.  <code>signals[i]</code> is assumed to be an array of shape <code>num_samp × num_chan</code>.  We use the first few samples of all acquisition data together in the same calculation to get a good estimate of the correct channel weights.</p><p>These assumptions should be valid to assess the relative coil SNR for spectroscopy of a single voxel; for other experiments you may want to use a different method, or restrict calculation of weights to a different <code>signal_range</code>.</p><p><code>channels</code> can be set to a index-like object in order to combine only a subset of channels.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/TRIImaging/MagneticResonanceSignals.jl/blob/a57123595a88377871e2135ed156c643b922ab6c/src/coil_combination.jl#LL41-L57">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="MagneticResonanceSignals.combine_channels" href="#MagneticResonanceSignals.combine_channels"><code>MagneticResonanceSignals.combine_channels</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia">combine_channels(combiner::ChannelCombiner, data)</code></pre><p>Combine channels data residing in a <code>NxC</code> matrix <code>data</code>, where <code>N</code> is number of temporal samples and <code>C</code> the number of channels.  Alternatively, <code>data</code> can be an acquisition.</p><p>See <code>pca_channel_combiner()</code> to create a ChannelCombiner functor.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/TRIImaging/MagneticResonanceSignals.jl/blob/a57123595a88377871e2135ed156c643b922ab6c/src/coil_combination.jl#LL26-L34">source</a></section></article><h3 id="Windows-and-windowing-1"><a class="docs-heading-anchor" href="#Windows-and-windowing-1">Windows and windowing</a><a class="docs-heading-anchor-permalink" href="#Windows-and-windowing-1" title="Permalink"></a></h3><article class="docstring"><header><a class="docstring-binding" id="MagneticResonanceSignals.zeropad" href="#MagneticResonanceSignals.zeropad"><code>MagneticResonanceSignals.zeropad</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia">zeropad(fid, axis, pad)</code></pre><p>Zero pad an FID for Fourier interpolation</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/TRIImaging/MagneticResonanceSignals.jl/blob/a57123595a88377871e2135ed156c643b922ab6c/src/processing.jl#LL3-L7">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="MagneticResonanceSignals.apply_window" href="#MagneticResonanceSignals.apply_window"><code>MagneticResonanceSignals.apply_window</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia">apply_window(signal, axis1=&gt;win1, axis2=&gt;win2, ...)</code></pre><p>Apply window functions <code>win1</code> along <code>axis1</code>, <code>win2</code> along <code>axis2</code>, etc.  The windows should be functions over the dimensionless time domain <code>0..1</code>; the axes should be of type <code>AxisArrays.Axis</code>.</p><p><strong>Background</strong></p><p>For the purposes of spectroscopy, the MR signal is generally an oscillating decaying signal in the time domain, with different metabolites having different decay constants. When computing a spectrum with a simple Fourier transform, one may window the time domain data to emphasize one metabolite or another in the resulting spectrum. (Spatially resolved spectroscopy involves some kind of MR echo so the initial part of the signal <em>may</em> be increasing, but the this doesn&#39;t affect the irreversible decay mechanisms.)</p><p>For <em>qualitative</em> exploration of the spectra, one may therefore want to choose out of several windowing functions with convenient parametric forms. Note that for <em>quantitative</em> measurement of metabolite concentration, windowing distorts the relative peak volumes and it&#39;s probably better to choose a time domain fitting method.</p><p>Note that these MR-specific reasons are subtly different - and apply in addition to - the generic signal processing reasons for time domain windowing.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/TRIImaging/MagneticResonanceSignals.jl/blob/a57123595a88377871e2135ed156c643b922ab6c/src/windows.jl#LL25-L50">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="MagneticResonanceSignals.apply_window!" href="#MagneticResonanceSignals.apply_window!"><code>MagneticResonanceSignals.apply_window!</code></a> — <span class="docstring-category">Function</span></header><section><div><p>Apply <code>windowfunc</code> over the dimensionless time range <code>(0:tlen-1)/tlen)</code> of <code>fid</code> along dimension <code>axis</code> which can be an <code>Axis</code> or <code>Integer</code>.</p><p>See also <code>apply_window</code>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/TRIImaging/MagneticResonanceSignals.jl/blob/a57123595a88377871e2135ed156c643b922ab6c/src/windows.jl#LL13-L18">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="MagneticResonanceSignals.sinebell" href="#MagneticResonanceSignals.sinebell"><code>MagneticResonanceSignals.sinebell</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia">sinebell(t; skew=1, pow=1)</code></pre><p>The sinebell window on the dimensionless time range <code>t ∈ 0..1</code>.</p><p>Use <code>pow=2</code> for sinebell squared. Setting the <code>skew</code> parameter to something other than the default of <code>1.0</code> gives a skewed sinebell window, as in Felix NMR.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/TRIImaging/MagneticResonanceSignals.jl/blob/a57123595a88377871e2135ed156c643b922ab6c/src/windows.jl#LL60-L67">source</a></section></article><h3 id="Water-suppression-1"><a class="docs-heading-anchor" href="#Water-suppression-1">Water suppression</a><a class="docs-heading-anchor-permalink" href="#Water-suppression-1" title="Permalink"></a></h3><article class="docstring"><header><a class="docstring-binding" id="MagneticResonanceSignals.hsvd" href="#MagneticResonanceSignals.hsvd"><code>MagneticResonanceSignals.hsvd</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia">hsvd(fid, rank)</code></pre><p>Use the Hankel singular value decomposition method for fitting a sum of exponential signals of the form</p><pre><code class="language-none">xₙ = Σₖ Aₖ zₖⁿ</code></pre><p>to compute the ampltudes Aₖ and complex-valued poles zₖ. Any poles with |zₖ| &gt; 1 are discarded to avoid numerical instability during the fit. A tuple of poles, amplitudes and the exponential basis (z,A,basis) is returned.</p><p>The discrete-time and continuous time signals are related by</p><pre><code class="language-none">sₙ =  Aₖ zₖⁿ  =  Aₖ exp((-bₖ + iωₖ) * tₙ)</code></pre><p>or</p><pre><code class="language-none">zₖ  =  exp((-bₖ + iωₖ) * Δt)</code></pre><p>where ωₖ is an angular frequency and bₖ the decay rate in Hz.</p><p>Ref. to NMR literature: Barkhuijsen et al., &quot;Improved Algorithm for Noniterative Time-Domain Model Fitting to Exponentially Damped Magnetic Resonance Signals&quot;, J. Mag. Res., (1987) https://doi.org/10.1016/0022-2364(87)90023-0</p><p>More broadly these techniques seem to come under the title &quot;Singular Spectrum analysis&quot;.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/TRIImaging/MagneticResonanceSignals.jl/blob/a57123595a88377871e2135ed156c643b922ab6c/src/hsvd.jl#LL2-L30">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="MagneticResonanceSignals.hsvd_water_suppression" href="#MagneticResonanceSignals.hsvd_water_suppression"><code>MagneticResonanceSignals.hsvd_water_suppression</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia">function hsvd_water_suppression(fid; dt = 0.0008, water_center_freq=0.0,
                                bandwidth=100.0, hsvd_rank=50)</code></pre><p>Use HSVD to suppress a spectral region.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/TRIImaging/MagneticResonanceSignals.jl/blob/a57123595a88377871e2135ed156c643b922ab6c/src/hsvd.jl#LL60-L65">source</a></section></article><h3 id="Phase-correction-1"><a class="docs-heading-anchor" href="#Phase-correction-1">Phase correction</a><a class="docs-heading-anchor-permalink" href="#Phase-correction-1" title="Permalink"></a></h3><article class="docstring"><header><a class="docstring-binding" id="MagneticResonanceSignals.adjust_phase" href="#MagneticResonanceSignals.adjust_phase"><code>MagneticResonanceSignals.adjust_phase</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia">function adjust_phase(spectrum, zero_phase=0.0, first_phase=0.0, fixed_frequency=0.0)</code></pre><p>Adjust phases of the signal.</p><p><strong>Example</strong></p><pre><code class="language-none">expt = mr_load(&quot;path/to/twix&quot;)
spec = spectrum(expt)
ph0, ph1 = ernst(spec)
spec_ph = adjust_phase(spec; zero_phase=ph0, first_phase=ph1)</code></pre></div><a class="docs-sourcelink" target="_blank" href="https://github.com/TRIImaging/MagneticResonanceSignals.jl/blob/a57123595a88377871e2135ed156c643b922ab6c/src/processing.jl#LL76-L89">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="MagneticResonanceSignals.ernst" href="#MagneticResonanceSignals.ernst"><code>MagneticResonanceSignals.ernst</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia">function ernst(spectrum)</code></pre><p>Estimates the zero and first order phase parameters which minimise the integral of imaginary part of the spectrum.</p><p>This implementation is based on suspect.py. See: https://github.com/openmrslab/suspect/blob/master/suspect/processing/phase.py</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/TRIImaging/MagneticResonanceSignals.jl/blob/a57123595a88377871e2135ed156c643b922ab6c/src/processing.jl#LL117-L125">source</a></section></article><h3 id="Baseline-correction-1"><a class="docs-heading-anchor" href="#Baseline-correction-1">Baseline correction</a><a class="docs-heading-anchor-permalink" href="#Baseline-correction-1" title="Permalink"></a></h3><article class="docstring"><header><a class="docstring-binding" id="MagneticResonanceSignals.baseline_als" href="#MagneticResonanceSignals.baseline_als"><code>MagneticResonanceSignals.baseline_als</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia">function baseline_als(spectrum, lambda::Float64, p::Float64; niter::Int64=10)</code></pre><p>Baseline correction based on ALS (Asymmetric Least Square).</p><p>Lambda is 2nd derivative constraint, which contributes to the smoothness, while p is weighting of positive residuals, which affect to the asymmetry.</p><p>This implementation is inspired by https://stackoverflow.com/a/29185844/5023889</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/TRIImaging/MagneticResonanceSignals.jl/blob/a57123595a88377871e2135ed156c643b922ab6c/src/processing.jl#LL148-L157">source</a></section></article><h2 id="Plotting-1"><a class="docs-heading-anchor" href="#Plotting-1">Plotting</a><a class="docs-heading-anchor-permalink" href="#Plotting-1" title="Permalink"></a></h2><article class="docstring"><header><a class="docstring-binding" id="MagneticResonanceSignals.felix_colors" href="#MagneticResonanceSignals.felix_colors"><code>MagneticResonanceSignals.felix_colors</code></a> — <span class="docstring-category">Constant</span></header><section><div><p>A popular color map for multidimensional NMR data as defined in Felix NMR</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/TRIImaging/MagneticResonanceSignals.jl/blob/a57123595a88377871e2135ed156c643b922ab6c/src/plotting.jl#LL51-L53">source</a></section></article></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../guide/">« How-to Guide</a></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> on <span class="colophon-date" title="Monday 16 March 2020 00:20">Monday 16 March 2020</span>. Using Julia version 1.3.1.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
