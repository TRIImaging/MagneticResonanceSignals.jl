<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>How-to Guide · MagneticResonanceSignals.jl</title><link href="https://fonts.googleapis.com/css?family=Lato|Roboto+Mono" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.11.1/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit">MagneticResonanceSignals.jl</span></div><form class="docs-search" action="../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../">Overview</a></li><li class="is-active"><a class="tocitem" href>How-to Guide</a><ul class="internal"><li><a class="tocitem" href="#APIs-for-loading-file-data-1"><span>APIs for loading file data</span></a></li><li><a class="tocitem" href="#Converting-Siemens-raw-data-to-Felix-format-1"><span>Converting Siemens raw data to Felix format</span></a></li><li><a class="tocitem" href="#Removing-unnecessary-adjustment-data-from-Siemens-raw-data-1"><span>Removing unnecessary adjustment data from Siemens raw data</span></a></li><li><a class="tocitem" href="#Processing-2D-L-COSY-spectroscopy-1"><span>Processing 2D L-COSY spectroscopy</span></a></li></ul></li><li><a class="tocitem" href="../reference/">Reference</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>How-to Guide</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>How-to Guide</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/TRIImaging/MagneticResonanceSignals.jl/blob/master/docs/src/guide.md#L" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="How-to-Guide-1"><a class="docs-heading-anchor" href="#How-to-Guide-1">How-to Guide</a><a class="docs-heading-anchor-permalink" href="#How-to-Guide-1" title="Permalink"></a></h1><h2 id="APIs-for-loading-file-data-1"><a class="docs-heading-anchor" href="#APIs-for-loading-file-data-1">APIs for loading file data</a><a class="docs-heading-anchor-permalink" href="#APIs-for-loading-file-data-1" title="Permalink"></a></h2><p>Raw data:</p><ul><li><p><code>load_twix</code> — load Siemens raw scanner <code>&quot;meas_*.dat&quot;</code> &quot;twix&quot; format, as produced by the twix exporter program available at clinical sites with a Siemens IDEA licence.</p></li><li><p><code>mr_load</code> — load raw scanner data and recognize the sequence, wrapping in sequence-specific metadata.</p></li></ul><p>Spectroscopy:</p><ul><li><code>load_rda</code>, <code>save_rda</code> — simple support for the Siemens &quot;.rda&quot; processed spectroscopy format.</li><li><code>save_nmrpipe</code> — save spectroscopy data to <a href="https://www.ibbr.umd.edu/nmrpipe/">NMRPipe</a> format. We have found this helpful for importing into mestrelab&#39;s <a href="https://mestrelab.com/software/mnova/">MNova</a> NMR processing software.</li><li><code>save_felix</code> — save spectroscopy data to <a href="http://www.felixnmr.com/">Felix NMR</a> &quot;.dat&quot; format.</li></ul><h2 id="Converting-Siemens-raw-data-to-Felix-format-1"><a class="docs-heading-anchor" href="#Converting-Siemens-raw-data-to-Felix-format-1">Converting Siemens raw data to Felix format</a><a class="docs-heading-anchor-permalink" href="#Converting-Siemens-raw-data-to-Felix-format-1" title="Permalink"></a></h2><p>The tool in <code>run/twix_to_felix.jl</code> can be used to convert Siemens raw MR &quot;twix&quot; data into a format usable by the Felix NMR processing software.</p><p>For example, to convert an raw file <code>meas_MID00069_FID104801_test.dat</code> into the felix file <code>meas_MID00069_FID104801_felix.dat</code>, you can use the following commands.  Note that (confusingly!) both Siemens raw data files and Felix input files have the .dat extension by convention.</p><pre><code class="language-none">run/twix_to_felix.jl  meas_MID00069_FID104801_test.dat  meas_MID00069_FID104801_felix.dat</code></pre><p>On windows, you may need to run from the cmd.exe prompt and specify the path to julia:</p><pre><code class="language-none">cd run
C:\path\to\julia.exe twix_to_felix.jl meas_MID00069_FID104801_test.dat  meas_MID00069_FID104801_felix.dat</code></pre><h2 id="Removing-unnecessary-adjustment-data-from-Siemens-raw-data-1"><a class="docs-heading-anchor" href="#Removing-unnecessary-adjustment-data-from-Siemens-raw-data-1">Removing unnecessary adjustment data from Siemens raw data</a><a class="docs-heading-anchor-permalink" href="#Removing-unnecessary-adjustment-data-from-Siemens-raw-data-1" title="Permalink"></a></h2><p>When saving raw data from a Siemens sequence with the twix program, the adjustment data is sometimes included (depending on the export settings).</p><p>Depending on the scanner settings this may include phase maps and other sequence data which can add up to several hundred megabytes of unnecessary data.</p><p>The script <code>strip_twix_adjustment.jl</code> is a small program to remove such adjustment data from Siemens twix to reduce the file size. For example, to convert <code>meas.dat</code> into <code>meas_stripped.dat</code>, use</p><pre><code class="language-none">$ julia --project=run run/strip_twix_adjustment.jl meas.dat meas_stripped.dat</code></pre><h2 id="Processing-2D-L-COSY-spectroscopy-1"><a class="docs-heading-anchor" href="#Processing-2D-L-COSY-spectroscopy-1">Processing 2D L-COSY spectroscopy</a><a class="docs-heading-anchor-permalink" href="#Processing-2D-L-COSY-spectroscopy-1" title="Permalink"></a></h2><p>Here&#39;s an example of how you can load L-COSY data from Siemens TWIX format, convert it into a spectrum and view that spectrum:</p><pre><code class="language-julia">using MagneticResonanceSignals, AxisArrays, Unitful

cosy = mr_load(&quot;meas_MID00417_FID85233_svs_lcosy.dat&quot;)

# High level interface: this does the whole spectral conversion for you using
# simple averaging.  You can set the windows here if you like.
spec = spectrum(cosy)

# Plot the absolute value of the spectrum
using Plots
pyplot()
getaxis(s, n) = ustrip.(uconvert.(u&quot;Hz&quot;, AxisArrays.axes(s, Axis{n}).val))
f1 = getaxis(spec, :freq1)
f2 = getaxis(spec, :freq2)
contour(f2, reverse(f1), Matrix(transpose(log.(abs.(spec)))); levels=-10:0.3:-3,
        seriescolor=cgrad(felix_colors), clims=(-10,-3),
        background_color=:black, aspectratio=1.0,
        xlabel=&quot;F2 (Hz)&quot;, ylabel=&quot;F1 (Hz)&quot;,
        xticks=-1000:100:1000, yticks=-1000:100:1000,
        xlim=[-200,550], ylim=[-200,550])</code></pre><p>Here&#39;s an example of how you can convert to Felix format:</p><pre><code class="language-julia">using MagneticResonanceSignals, AxisArrays

cosy = mr_load(&quot;meas_MID00417_FID85233_svs_lcosy.dat&quot;)
signal = simple_averaging(cosy, downsample=2)

# Extract some metadata required by the felix format
frequency = standard_metadata(cosy).frequency
f1_bandwidth = 1.0/step(AxisArrays.axes(signal, Axis{:time1}).val)
f2_bandwidth = 1.0/step(AxisArrays.axes(signal, Axis{:time2}).val)

save_felix(&quot;felix_input.dat&quot;, signal; bandwidth=(f2_bandwidth, f1_bandwidth), frequency=frequency)</code></pre><p>Here&#39;s an example of how to do the steps in <code>spectrum(cosy)</code>, with the averaging and windowing written out explicitly.</p><pre><code class="language-julia">signal = simple_averaging(cosy)

# Apply sine bell squared windows to signal, as in TRI Felix workflow
apply_window!(signal, Axis{:time2}, t-&gt;sinebell(t, pow=2, skew=0.3))
apply_window!(signal, Axis{:time1}, t-&gt;sinebell(t, pow=2))

# Add zero padding here
signal = zeropad(signal, Axis{:time1}, 4)

# Compute spectrum from time domain signal
spec = spectrum(signal)</code></pre></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../">« Overview</a><a class="docs-footer-nextpage" href="../reference/">Reference »</a></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> on <span class="colophon-date" title="Thursday 12 March 2020 03:12">Thursday 12 March 2020</span>. Using Julia version 1.3.1.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
